const translations = {
  en: {
    titles: {
      index: 'Clash Potion Calculator',
      simple: 'Simple Calc | Clash Potion Calculator',
      builder: 'Builder Potion | Clash Potion Calculator',
      research: 'Research Potion | Clash Potion Calculator',
      pet: 'Pet Potion | Clash Potion Calculator',
      about: 'About | Clash Potion Calculator'
    },
    nav: {
      home: 'Home',
      simple: 'Simple Calc',
      builder: 'Builder Potion',
      research: 'Research Potion',
      pet: 'Pet Potion',
      about: 'About'
    },
    index: {
      title: 'Clash Potion Calculator',
      subtitle: 'Fast &amp; easy upgrade time calculations for Clash of Clans!',
      cardSimple: 'Simple Calculator',
      cardBuilder: 'Builder Potion',
      cardResearch: 'Research Potion',
      cardPet: 'Pet Potion'
    },
    simple: {
      title: 'Simple Calculator',
      labels: {days: 'Days', hours: 'Hours', minutes: 'Minutes'},
      button: 'Calculate',
      placeholder: 'Enter a duration and click Calculate.<br> The result will appear here!',
      resultEntered: 'Entered duration',
      resultEnd: 'End date'
    },
    builder: {
      title: 'Builder Potion Calculator',
      tabs: {potion: 'By Potions', boost: 'By Boost Time Left'},
      labels: {
        days: 'Days', hours: 'Hours', minutes: 'Minutes',
        potions: 'Builder Potions',
        boostHours: 'Boost Hours Left', boostMinutes: 'Boost Minutes Left',
        upDays: 'Upgrade Days Left', upHours: 'Upgrade Hours Left', upMinutes: 'Upgrade Minutes Left'
      },
      button: 'Calculate',
      placeholder: 'Enter an upgrade duration and number of potions,<br> then click <b>Calculate</b>.<br> Your result will appear here!',
      result: {
        upgradeDuration: 'Upgrade duration',
        potionsUsed: 'Potions used',
        timeUnder: 'Time under potion',
        normalLeft: 'Normal time left',
        endDate: 'End date',
        totalRemaining: 'Total remaining',
        upgradeLeft: 'Upgrade left',
        boostLeft: 'Boost left',
        covered: 'Covered by boost',
        finished: 'Finished entirely under boost!',
        timeUnderBoost: 'Time under boost'
      }
    },
    research: {
      title: 'Research Potion Calculator',
      tabs: {potion: 'By Potions', boost: 'By Boost Time Left'},
      labels: {
        days: 'Days', hours: 'Hours', minutes: 'Minutes',
        potions: 'Research Potions',
        boostHours: 'Boost Hours Left', boostMinutes: 'Boost Minutes Left',
        upDays: 'Upgrade Days Left', upHours: 'Upgrade Hours Left', upMinutes: 'Upgrade Minutes Left'
      },
      button: 'Calculate',
      placeholder: 'Enter an upgrade duration and number of potions,<br> then click <b>Calculate</b>.<br> Your result will appear here!',
      result: {
        upgradeDuration: 'Upgrade duration',
        potionsUsed: 'Potions used',
        timeUnder: 'Time under potion',
        normalLeft: 'Normal time left',
        endDate: 'End date',
        totalRemaining: 'Total remaining',
        upgradeLeft: 'Upgrade left',
        boostLeft: 'Boost left',
        covered: 'Covered by boost',
        finished: 'Finished entirely under boost!',
        timeUnderBoost: 'Time under boost'
      }
    },
    pet: {
      title: 'Pet Potion Calculator',
      tabs: {potion: 'By Potions', boost: 'By Boost Time Left'},
      labels: {
        days: 'Days', hours: 'Hours', minutes: 'Minutes',
        potions: 'Pet Potions',
        boostHours: 'Boost Hours Left', boostMinutes: 'Boost Minutes Left',
        upDays: 'Upgrade Days Left', upHours: 'Upgrade Hours Left', upMinutes: 'Upgrade Minutes Left'
      },
      button: 'Calculate',
      placeholder: 'Enter an upgrade duration and number of potions,<br> then click <b>Calculate</b>.<br> Your result will appear here!',
      result: {
        upgradeDuration: 'Upgrade duration',
        potionsUsed: 'Potions used',
        timeUnder: 'Time under potion',
        normalLeft: 'Normal time left',
        endDate: 'End date',
        totalRemaining: 'Total remaining',
        upgradeLeft: 'Upgrade left',
        boostLeft: 'Boost left',
        covered: 'Covered by boost',
        finished: 'Finished entirely under boost!',
        timeUnderBoost: 'Time under boost'
      }
    },
    about: {
      title: 'About Clash Potion Calculator',
      p1: '<strong>Clash Potion Calculator</strong> is a fan-made tool for Clash of Clans players, built to help you quickly and easily calculate upgrade or research finish times when using potions.<br><br>Created with ❤️ by <strong>Lukas Mauffré</strong> (<a href="https://github.com/LukasMFR/clash-potion-calculator" target="_blank" rel="noopener" class="about__link">view source on GitHub</a>).',
      disclaimer: 'This project is <strong>not affiliated with, endorsed, sponsored, or specifically approved by Supercell or Clash of Clans</strong>.<br>Clash of Clans and Supercell are trademarks or registered trademarks of Supercell Oy. For more information, see <a href="https://supercell.com/fan-content-policy" target="_blank" rel="noopener" class="about__link">Supercell\u2019s Fan Content Policy</a>.',
      supportTitle: '☕ Support the Project',
      supportText: 'If you found this tool helpful and want to support my work, you can buy me a coffee here:',
      thanks: 'Thank you so much!',
      version: 'Version:',
      source: 'Source code:',
      repo: 'GitHub Repository'
    }
  },
  fr: {
    titles: {
      index: 'Clash Potion Calculator',
      simple: 'Calcul simple | Clash Potion Calculator',
      builder: 'Potion du constructeur | Clash Potion Calculator',
      research: 'Potion de recherche | Clash Potion Calculator',
      pet: 'Potion de familier | Clash Potion Calculator',
      about: 'À propos | Clash Potion Calculator'
    },
    nav: {
      home: 'Accueil',
      simple: 'Calcul simple',
      builder: 'Potion du constructeur',
      research: 'Potion de recherche',
      pet: 'Potion de familier',
      about: 'À propos'
    },
    index: {
      title: 'Clash Potion Calculator',
      subtitle: 'Calcul rapide et facile des temps d\'amélioration pour Clash of Clans\u202f!',
      cardSimple: 'Calculatrice simple',
      cardBuilder: 'Potion du constructeur',
      cardResearch: 'Potion de recherche',
      cardPet: 'Potion de familier'
    },
    simple: {
      title: 'Calculatrice simple',
      labels: {days: 'Jours', hours: 'Heures', minutes: 'Minutes'},
      button: 'Calculer',
      placeholder: 'Entrez une durée puis cliquez sur Calculer.<br>Le résultat apparaîtra ici\u202f!',
      resultEntered: 'Durée saisie',
      resultEnd: 'Date de fin'
    },
    builder: {
      title: 'Calculateur de Potion du constructeur',
      tabs: {potion: 'Par potions', boost: 'Par temps de boost'},
      labels: {
        days: 'Jours', hours: 'Heures', minutes: 'Minutes',
        potions: 'Potions du constructeur',
        boostHours: 'Heures de boost restantes', boostMinutes: 'Minutes de boost restantes',
        upDays: 'Jours restants', upHours: 'Heures restantes', upMinutes: 'Minutes restantes'
      },
      button: 'Calculer',
      placeholder: 'Indiquez la durée de l\'amélioration et le nombre de potions,<br> puis cliquez sur <b>Calculer</b>.<br>Votre résultat s\'affichera ici\u202f!',
      result: {
        upgradeDuration: 'Durée de l\'amélioration',
        potionsUsed: 'Potions utilisées',
        timeUnder: 'Temps sous potion',
        normalLeft: 'Temps normal restant',
        endDate: 'Date de fin',
        totalRemaining: 'Temps total restant',
        upgradeLeft: 'Amélioration restante',
        boostLeft: 'Boost restant',
        covered: 'Temps couvert par le boost',
        finished: 'Entièrement terminé sous boost\u202f!',
        timeUnderBoost: 'Temps sous boost'
      }
    },
    research: {
      title: 'Calculateur de Potion de recherche',
      tabs: {potion: 'Par potions', boost: 'Par temps de boost'},
      labels: {
        days: 'Jours', hours: 'Heures', minutes: 'Minutes',
        potions: 'Potions de recherche',
        boostHours: 'Heures de boost restantes', boostMinutes: 'Minutes de boost restantes',
        upDays: 'Jours restants', upHours: 'Heures restantes', upMinutes: 'Minutes restantes'
      },
      button: 'Calculer',
      placeholder: 'Indiquez la durée de la recherche et le nombre de potions,<br> puis cliquez sur <b>Calculer</b>.<br>Votre résultat s\'affichera ici\u202f!',
      result: {
        upgradeDuration: 'Durée de la recherche',
        potionsUsed: 'Potions utilisées',
        timeUnder: 'Temps sous potion',
        normalLeft: 'Temps normal restant',
        endDate: 'Date de fin',
        totalRemaining: 'Temps total restant',
        upgradeLeft: 'Recherche restante',
        boostLeft: 'Boost restant',
        covered: 'Temps couvert par le boost',
        finished: 'Entièrement terminé sous boost\u202f!',
        timeUnderBoost: 'Temps sous boost'
      }
    },
    pet: {
      title: 'Calculateur de Potion de familier',
      tabs: {potion: 'Par potions', boost: 'Par temps de boost'},
      labels: {
        days: 'Jours', hours: 'Heures', minutes: 'Minutes',
        potions: 'Potions de familier',
        boostHours: 'Heures de boost restantes', boostMinutes: 'Minutes de boost restantes',
        upDays: 'Jours restants', upHours: 'Heures restantes', upMinutes: 'Minutes restantes'
      },
      button: 'Calculer',
      placeholder: 'Indiquez la durée de l\'amélioration et le nombre de potions,<br> puis cliquez sur <b>Calculer</b>.<br>Votre résultat s\'affichera ici\u202f!',
      result: {
        upgradeDuration: 'Durée de l\'amélioration',
        potionsUsed: 'Potions utilisées',
        timeUnder: 'Temps sous potion',
        normalLeft: 'Temps normal restant',
        endDate: 'Date de fin',
        totalRemaining: 'Temps total restant',
        upgradeLeft: 'Amélioration restante',
        boostLeft: 'Boost restant',
        covered: 'Temps couvert par le boost',
        finished: 'Entièrement terminé sous boost\u202f!',
        timeUnderBoost: 'Temps sous boost'
      }
    },
    about: {
      title: 'À propos de Clash Potion Calculator',
      p1: '<strong>Clash Potion Calculator</strong> est un outil créé par des fans pour les joueurs de Clash of Clans, conçu pour vous aider à calculer rapidement et facilement la fin de vos améliorations ou recherches lorsque vous utilisez des potions.<br><br>Créé avec ❤️ par <strong>Lukas Mauffré</strong> (<a href="https://github.com/LukasMFR/clash-potion-calculator" target="_blank" rel="noopener" class="about__link">voir le code source sur GitHub</a>).',
      disclaimer: 'Ce projet n\'est <strong>pas affilié, sponsorisé ou approuvé par Supercell ou Clash of Clans</strong>.<br>Clash of Clans et Supercell sont des marques déposées de Supercell Oy. Pour plus d\'informations, consultez <a href="https://supercell.com/fan-content-policy" target="_blank" rel="noopener" class="about__link">la politique de contenu des fans de Supercell</a>.',
      supportTitle: '☕ Soutenir le projet',
      supportText: 'Si vous trouvez cet outil utile et souhaitez soutenir mon travail, vous pouvez m\'offrir un café ici&nbsp;:',
      thanks: 'Merci beaucoup&nbsp;!',
      version: 'Version&nbsp;:',
      source: 'Code source&nbsp;:',
      repo: 'Dépôt GitHub'
    }
  }
};

let currentLang = localStorage.getItem('lang') || (navigator.language && navigator.language.startsWith('fr') ? 'fr' : 'en');

function t(key) {
  const parts = key.split('.');
  let res = translations[currentLang];
  for (const p of parts) {
    if (res && p in res) res = res[p]; else { res = undefined; break; }
  }
  return res !== undefined ? res : key;
}

function applyLang(lang) {
  currentLang = lang;
  document.documentElement.lang = lang;
  const texts = document.querySelectorAll('[data-i18n]');
  texts.forEach(el => {
    const val = t(el.dataset.i18n);
    if (val !== undefined) el.innerHTML = val;
  });
  document.querySelectorAll('[data-i18n-title]').forEach(el => {
    const val = t(el.dataset.i18nTitle);
    if (val !== undefined) el.title = val;
  });
  document.querySelectorAll('[data-i18n-alt]').forEach(el => {
    const val = t(el.dataset.i18nAlt);
    if (val !== undefined) el.alt = val;
  });
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const val = t(el.dataset.i18nPlaceholder);
    if (val !== undefined) el.placeholder = val;
  });
  const titleEl = document.querySelector('title[data-i18n]');
  if (titleEl) titleEl.textContent = t(titleEl.dataset.i18n);
}

function initLangMenu() {
  const dropdown = document.getElementById('lang-dropdown');
  const btn = document.getElementById('lang-btn');
  if (!btn || !dropdown) return;
  btn.addEventListener('click', () => {
    dropdown.classList.toggle('show');
  });
  document.addEventListener('click', (e) => {
    if (!btn.contains(e.target) && !dropdown.contains(e.target)) {
      dropdown.classList.remove('show');
    }
  });
  dropdown.querySelectorAll('[data-lang-select]').forEach(el => {
    el.addEventListener('click', () => {
      const lang = el.dataset.langSelect;
      localStorage.setItem('lang', lang);
      applyLang(lang);
      dropdown.classList.remove('show');
    });
  });
}

document.addEventListener('DOMContentLoaded', () => {
  applyLang(currentLang);
  initLangMenu();
});
